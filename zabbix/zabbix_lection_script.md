# zabbix lection


Заббікс 
## основні компоненти заббікса (слайд 3)
###  вебінтерфейс(php), заббікс-сервер, база (mysql, postgres)
сам сервер  підтримує безагентні моніторинги: базі ip-протоколу.
Агентні моніторинги - це окремий екземпляр ПЗ, сервіс якій як правило працює на хості(віртуальній машині), який потрібно моніторити. спілкуєтсся по tcp. як правило не вибагливий до ресурсів
Принаймні хост де крутиться сервер може виступати хостом для агента також.
Також може бути розширений горізонтально проксі-сервером, це сервіс, приблизно такий самий як заббікс-сервер, не плутати з http-проксі або tcp-проксі.
Вирішує проблеми нестабільного мережевого доступа, або обмеження файрвола наприклад філіали, інший цод, чужий проект в хмарі. 
І може вирішувати задачу горізонтального масштабування, сбирати велику кількість метрік, деякий препроцессінг метрік вібдувається на проксях. з точки зору агентів прокси-він виглядає як заббікс-сервер. Навіть агентам в якості парамаметра  "заббікс-сервера" конфігурують ip/dns проксі. Потрибує окрему бд, може знову ж таки бути mysql postgres, але проксі також може жити і на sqlite (має сенс для невеликого remote філіала на 1-2тис метрік на хвилину)

Веб-інтерфейс - це застосунок на php, може бути розгонутий як на можлимвостях вебсервера як apache,
так і може nginx, але він тоді потрібно прикрутити наприклад php-fpm. php потрібно мати доступ як до zabbix-сервера (10051/tcp), так і до бази

агенти можуть бути сконфігуровані як активні або я пасивні (дефолтно). 
пасивні - очікують що забікс-сервер їх явно викличе(10050/tcp), той виконає перевірку поверне метріку.
активні - коли стартують, отримують від заббікс-сервера інформацію які метріки на данному хості потрібно з якою частотою повертати, самостійно незалежно від сервера мають виконують перевірки, повертають значення на так звані trapper порт 10051.


## слайди 4-7 встановлення zabbix. 
продемонструвати сайт https://www.zabbix.com/download - 
в пакетах під операційну систему. 
через маркетплейс в клаудах
контейнери - у мене стенд розгорнутий саме так, докер-композ.
і навіть віртуальні машини. 
і звісно компіляція бінарів з source-code. Як виявляється зовсім це нестрашно та нескладно. До короновірусного карантіна у мене був такий варіант.

при першому успішному запуску інсталляція через вебінтерфейс буде виглядати так.
слайди.

## основні сутності заббікса (слайд 8)
### хост, item, trigger
host.
item-и належать конкретному хосту. - 
триггери - належать конкретному хосту, посилаються на item, їх значення, зміну значень з часом, тощо. 
можуть посилатись і на item іншого хоста. 

також існують групи хостів, але це сутність для потреб групування, одиниця видачі прав, тощо.

### сутності юзера 
юзер і група. права можна видавати группам юзерів  на группи хостів. індивідуальним юзерам неможна видавати права на індивідуальні групи, придеться під них робити групи. 
до сутності юзера віднесу поняття медіа/mediatype. важливий елемент алертингу. щось типа канала алертів
наприклад існують media type: email, sms, telegram, discord.
кожному юзеру можна додати свій email, sms.
можна створити спеціальний скрипт, який буде відсилати в telegram повідомлення.
для групових каналів рекомендую створювати окремі технічні юзери в заббікс. наприклад telegrambot-elastic, відповідний чат де будуть повідомлення щодо elastic/
хоча вони не будуть виглядати группами в заббікс, але ж повідомлення в такий груповий чат потрібно одне на всіх учасників, тому повідомлення повинно 

### сутності алертинга, action.
action - налаштування того при яких умовах, як і кому алертить.
може відпправити юзеру повідомлення, по одному або всім каналам. 
може відправити группі.
може виконати скрипт. 
може виконати різні дії при різних умовах, при переході з ок в проблему, при рекавері, або ще при "оновленні" наприклад був юзер який прийняв проблему, сказав що він єю займається.

окрім trigger based action бувають ще інші умови, але ми розглянемо trigger

## демо - огляд сутностєй через демо сайта.
1. дашборд Global view
2. monitoring problems
3. Data colection - hosts
http://zabbix.local/zabbix.php?action=host.list 

### host:

розглянути хост, вибір інтефейсів (агент, snmp, тощо).
для прикладу рознлянути Хост з назвою UserParameters
розглянути заббікс-агент на хості, параметр Server

### item:
розглянути item-и на хості UserParameters

створити item і розглянути різні види параметрів.
default - це типовий лінукс. на базі шаблона.
example http test - подивитись на http.
userParameter - подивитись на http
elasticsearch - на базі http

### trigger:
userParameter - там триггер. перестворити триггер.

### юзери:
розглянути поле медіа, групи, як назначаються права.

### медіатайпи:
розглянути приклад з телеграмом як з вебхуком, також створення медіа на базі довільного скрипта.
увімкнути смс, 

повенутись до юзерів - розглянути поле медіа.


# templating:


# discovery:

TODO: подивитись на discovery 
https://blog.zabbix.com/how-to-use-zabbix-low-level-discovery/9993/
на прикладі пошука cpu.


# host discovery:

TODO:  створити середовище: proxy + discovery хостів з заббікс-агентом, авторегістрація хостів.